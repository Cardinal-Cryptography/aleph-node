---
name: Install rust toolchain
description: |
  Reads rust toolchain from rust-toolchain file, installs it with wasm32-unknown-unknown target
runs:
  using: composite
  steps:
    # This step needs to be extracted either to docker image or to setup of self-hosted runner
    - name: Install rustup
      shell: bash
      run: |
        if ! command -v rustup &>/dev/null; then
          curl --proto '=https' --tlsv1.2 --retry 10 --retry-connrefused -fsSL \
            "https://sh.rustup.rs" | sh -s -- --default-toolchain none -y
          echo "${CARGO_HOME:-$HOME/.cargo}/bin" >> $GITHUB_PATH
        fi

    - name: Read rust toolchain file
      id: read-rust-toolchain-file
      shell: bash
      run: |
        toolchain=$(cat rust-toolchain | xargs)
        echo "${toolchain}" >> $GITHUB_PATH

    - name: Install rust toolchain
      shell: bash
      run: |
        rustup toolchain install ${{ steps.read-rust-toolchain-file.outputs.toolchain }} --target wasm32-unknown-unknown
