# The sole purpose of this Dockerfile is to override the default behaviour of the `prometheus` image, i.e. storing collected data in a docker's volume.
# It simplifies the procedure of saving of collected data for later analysis.
# Feel free to remove it (remember to modify the `docker-compose.yml` accordingly) if you find a better solution.
ARG ARCH="amd64"
ARG OS="linux"
FROM prom/prometheus:v2.30.3

USER root
RUN mkdir /prometheus.data && chown -R nobody:nobody /prometheus.data
USER nobody
WORKDIR /prometheus.data
# This line override `CMD` defined by the `prometheus` docker image, so it stores its data internally relative to its container.
CMD [ "--config.file=/etc/prometheus/prometheus.yml", \
      "--storage.tsdb.path=/prometheus.data", \
      "--web.console.libraries=/usr/share/prometheus/console_libraries", \
      "--web.console.templates=/usr/share/prometheus/consoles" ]